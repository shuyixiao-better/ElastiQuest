# Markdown æ¸²æŸ“ä¼˜åŒ–è¯´æ˜

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡

ä¼˜åŒ– RAG é—®ç­”é¡µé¢çš„å›ç­”æ˜¾ç¤ºæ•ˆæœï¼Œæ”¯æŒå®Œæ•´çš„ Markdown æ ¼å¼æ¸²æŸ“ï¼ŒåŒ…æ‹¬ï¼š
- âœ… æ ‡é¢˜ï¼ˆH1-H6ï¼‰
- âœ… åˆ—è¡¨ï¼ˆæœ‰åºã€æ— åºã€åµŒå¥—ï¼‰
- âœ… ä»£ç å—ï¼ˆå¸¦è¯­æ³•é«˜äº®ï¼‰
- âœ… è¡Œå†…ä»£ç 
- âœ… è¡¨æ ¼
- âœ… å¼•ç”¨å—
- âœ… é“¾æ¥
- âœ… ç²—ä½“ã€æ–œä½“ã€åˆ é™¤çº¿
- âœ… åˆ†å‰²çº¿
- âœ… ä»»åŠ¡åˆ—è¡¨
- âœ… å›¾ç‰‡
- âœ… **é«˜äº®å¼•ç”¨å†…å®¹**ï¼ˆä¿ç•™åŸæœ‰åŠŸèƒ½ï¼‰

## ğŸ“¦ ä¾èµ–å®‰è£…

éœ€è¦å®‰è£…ä»¥ä¸‹ npm åŒ…ï¼š

```bash
cd frontend
npm install react-markdown remark-gfm rehype-highlight rehype-raw highlight.js
```

### ä¾èµ–è¯´æ˜

| åŒ…å | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| `react-markdown` | ^9.x | React Markdown æ¸²æŸ“æ ¸å¿ƒåº“ |
| `remark-gfm` | ^4.x | GitHub Flavored Markdown æ”¯æŒï¼ˆè¡¨æ ¼ã€ä»»åŠ¡åˆ—è¡¨ç­‰ï¼‰ |
| `rehype-highlight` | ^7.x | ä»£ç è¯­æ³•é«˜äº® |
| `rehype-raw` | ^7.x | æ”¯æŒ HTML æ ‡ç­¾ï¼ˆç”¨äºé«˜äº®æ ‡è®°ï¼‰ |
| `highlight.js` | ^11.x | ä»£ç é«˜äº®æ ·å¼åº“ |

## ğŸ“ æ–°å¢/ä¿®æ”¹çš„æ–‡ä»¶

### 1. **æ–°å¢**: `src/components/RAG/MarkdownRenderer.tsx`

çº¯ Markdown æ¸²æŸ“ç»„ä»¶ï¼Œç”¨äºæµå¼æ˜¾ç¤ºé˜¶æ®µã€‚

**ç‰¹æ€§**:
- æ”¯æŒ GFM (GitHub Flavored Markdown)
- ä»£ç è¯­æ³•é«˜äº®
- è‡ªå®šä¹‰æ ·å¼ï¼ˆGitHub é£æ ¼ï¼‰
- å“åº”å¼è¡¨æ ¼
- å¤–éƒ¨é“¾æ¥è‡ªåŠ¨æ·»åŠ  `target="_blank"`

**ä½¿ç”¨**:
```tsx
import MarkdownRenderer from '@/components/RAG/MarkdownRenderer';

<MarkdownRenderer content={markdownText} />
```

### 2. **ä¿®æ”¹**: `src/components/RAG/HighlightedText.tsx`

å¢å¼ºçš„é«˜äº®æ–‡æœ¬ç»„ä»¶ï¼Œæ”¯æŒ Markdown + é«˜äº®ã€‚

**æ ¸å¿ƒæ”¹è¿›**:
- å°†é«˜äº®ç‰‡æ®µè½¬æ¢ä¸ºå¸¦ `<mark>` æ ‡ç­¾çš„ Markdown
- ä½¿ç”¨ `rehype-raw` æ’ä»¶æ”¯æŒ HTML æ ‡ç­¾
- ä¿ç•™åŸæœ‰é«˜äº®åŠŸèƒ½çš„åŒæ—¶æ”¯æŒ Markdown æ ¼å¼

**å·¥ä½œåŸç†**:
```typescript
// 1. å°†ç‰‡æ®µé‡æ–°ç»„åˆæˆå¸¦é«˜äº®æ ‡è®°çš„ Markdown
const markdownContent = segments
  .map((segment) => {
    if (segment.highlighted) {
      return `<mark class="highlight-mark">${segment.text}</mark>`;
    }
    return segment.text;
  })
  .join('');

// 2. ä½¿ç”¨ ReactMarkdown æ¸²æŸ“
<ReactMarkdown rehypePlugins={[rehypeRaw]}>
  {markdownContent}
</ReactMarkdown>
```

### 3. **ä¿®æ”¹**: `src/components/RAG/RAGChatPanel.tsx`

æ›´æ–°å›ç­”æ˜¾ç¤ºé€»è¾‘ã€‚

**æ”¹è¿›**:
- æµå¼æ˜¾ç¤ºé˜¶æ®µï¼šä½¿ç”¨ `MarkdownRenderer` æ¸²æŸ“ Markdown
- å®Œæˆé˜¶æ®µï¼šä½¿ç”¨ `HighlightedText` æ¸²æŸ“å¸¦é«˜äº®çš„ Markdown
- ä¼˜åŒ–å¡ç‰‡æ ·å¼

## ğŸ¨ æ ·å¼è®¾è®¡

### é«˜äº®æ ‡è®°æ ·å¼

```css
.highlight-mark {
  background-color: #fff3cd;  /* æ·¡é»„è‰²èƒŒæ™¯ */
  color: #856404;             /* æ·±é»„è‰²æ–‡å­— */
  padding: 2px 6px;           /* å†…è¾¹è· */
  border-radius: 3px;         /* åœ†è§’ */
  font-weight: 500;           /* ç¨ç²—å­—ä½“ */
  border: 1px solid #ffeaa7;  /* è¾¹æ¡† */
}
```

### Markdown æ ·å¼

é‡‡ç”¨ **GitHub é£æ ¼**æ ·å¼ï¼š

- **æ ‡é¢˜**: æ¸è¿›å¼å­—å·ï¼ŒH1/H2 å¸¦ä¸‹åˆ’çº¿
- **ä»£ç å—**: æµ…ç°èƒŒæ™¯ (#f6f8fa)ï¼Œå¸¦è¾¹æ¡†
- **è¡Œå†…ä»£ç **: ç²‰çº¢è‰²æ–‡å­— (#e83e8c)ï¼Œæµ…ç°èƒŒæ™¯
- **è¡¨æ ¼**: æ–‘é©¬çº¹ï¼Œè¡¨å¤´æ·±è‰²èƒŒæ™¯
- **å¼•ç”¨**: å·¦ä¾§è“è‰²è¾¹æ¡†ï¼Œæµ…ç°èƒŒæ™¯
- **é“¾æ¥**: è“è‰² (#0366d6)ï¼Œæ‚¬åœä¸‹åˆ’çº¿

## ğŸ”„ æ¸²æŸ“æµç¨‹

### æµå¼æ˜¾ç¤ºé˜¶æ®µ

```
ç”¨æˆ·æé—®
    â†“
LLM æµå¼è¿”å›
    â†“
é€å—ç´¯ç§¯ answer
    â†“
MarkdownRenderer æ¸²æŸ“
    â†“
æ˜¾ç¤ºæ ¼å¼åŒ–çš„ Markdown
```

### å®Œæˆé˜¶æ®µ

```
LLM å®Œæˆ
    â†“
åç«¯åˆ†æé«˜äº®
    â†“
è¿”å› highlights æ•°ç»„
    â†“
HighlightedText ç»„ä»¶
    â†“
å°†ç‰‡æ®µè½¬æ¢ä¸ºå¸¦ <mark> çš„ Markdown
    â†“
ReactMarkdown æ¸²æŸ“
    â†“
æ˜¾ç¤ºå¸¦é«˜äº®çš„æ ¼å¼åŒ– Markdown
```

## ğŸ“Š æ•ˆæœå¯¹æ¯”

### ä¼˜åŒ–å‰

```
çº¯æ–‡æœ¬æ˜¾ç¤ºï¼Œæ— æ ¼å¼ï¼š

### ğŸ¼ æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

**1. ä¸­æ–‡åˆ†è¯åŠ©æ‰‹**

- å°å®éªŒå‘½ä»¤ï¼šå¦‚ `ç”¨æˆ·å`ã€`ç”¨æˆ·ç®¡ç†`
- å¤§å®éªŒå‘½ä»¤ï¼šå¦‚ `ç”¨æˆ·ç™»å½•`ã€`USER_LOGIN`
...
```

### ä¼˜åŒ–å

```
å®Œæ•´ Markdown æ¸²æŸ“ï¼š

### ğŸ¼ æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

**1. ä¸­æ–‡åˆ†è¯åŠ©æ‰‹**

- å°å®éªŒå‘½ä»¤ï¼šå¦‚ `ç”¨æˆ·å`ã€`ç”¨æˆ·ç®¡ç†`
- å¤§å®éªŒå‘½ä»¤ï¼šå¦‚ `ç”¨æˆ·ç™»å½•`ã€`USER_LOGIN`
...
```

**è§†è§‰æ•ˆæœ**:
- âœ… æ ‡é¢˜æœ‰å±‚æ¬¡æ„Ÿ
- âœ… åˆ—è¡¨æœ‰ç¼©è¿›
- âœ… ä»£ç æœ‰é«˜äº®
- âœ… è¡¨æ ¼æœ‰è¾¹æ¡†
- âœ… å¼•ç”¨å†…å®¹æœ‰é«˜äº®æ ‡è®°

## ğŸš€ ä½¿ç”¨æ­¥éª¤

### 1. å®‰è£…ä¾èµ–

```bash
cd frontend
npm install react-markdown remark-gfm rehype-highlight rehype-raw highlight.js
```

### 2. é‡å¯å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

### 3. æµ‹è¯•æ•ˆæœ

è®¿é—® `http://localhost:3000/rag` æˆ– `http://10.10.0.153:3000/rag`

è¾“å…¥åŒ…å« Markdown æ ¼å¼çš„é—®é¢˜ï¼Œä¾‹å¦‚ï¼š

**é—®é¢˜**: "è¯·ä»‹ç» Elasticsearch çš„æ ¸å¿ƒåŠŸèƒ½"

**å‚è€ƒèµ„æ–™**: "Elasticsearch æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æœç´¢å¼•æ“..."

**é¢„æœŸæ•ˆæœ**:
- æµå¼æ˜¾ç¤ºæ—¶ï¼šMarkdown æ ¼å¼æ­£ç¡®æ¸²æŸ“
- å®Œæˆåï¼šå¼•ç”¨çš„å†…å®¹è¢«é«˜äº®æ ‡è®°

## ğŸ¯ æ”¯æŒçš„ Markdown è¯­æ³•

### æ ‡é¢˜

```markdown
# H1 æ ‡é¢˜
## H2 æ ‡é¢˜
### H3 æ ‡é¢˜
```

### åˆ—è¡¨

```markdown
- æ— åºåˆ—è¡¨é¡¹ 1
- æ— åºåˆ—è¡¨é¡¹ 2
  - åµŒå¥—é¡¹

1. æœ‰åºåˆ—è¡¨é¡¹ 1
2. æœ‰åºåˆ—è¡¨é¡¹ 2
```

### ä»£ç 

````markdown
è¡Œå†…ä»£ç ï¼š`const x = 1;`

ä»£ç å—ï¼š
```javascript
function hello() {
  console.log('Hello, World!');
}
```
````

### è¡¨æ ¼

```markdown
| åˆ—1 | åˆ—2 | åˆ—3 |
|-----|-----|-----|
| A   | B   | C   |
| D   | E   | F   |
```

### å¼•ç”¨

```markdown
> è¿™æ˜¯ä¸€æ®µå¼•ç”¨æ–‡æœ¬
> å¯ä»¥å¤šè¡Œ
```

### é“¾æ¥å’Œå›¾ç‰‡

```markdown
[é“¾æ¥æ–‡æœ¬](https://example.com)
![å›¾ç‰‡æè¿°](https://example.com/image.png)
```

### æ–‡æœ¬æ ¼å¼

```markdown
**ç²—ä½“**
*æ–œä½“*
~~åˆ é™¤çº¿~~
```

### ä»»åŠ¡åˆ—è¡¨

```markdown
- [x] å·²å®Œæˆä»»åŠ¡
- [ ] æœªå®Œæˆä»»åŠ¡
```

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: ä¾èµ–å®‰è£…å¤±è´¥

**é”™è¯¯**: `npm install` å¤±è´¥

**è§£å†³**:
```bash
# æ¸…ç†ç¼“å­˜
npm cache clean --force

# åˆ é™¤ node_modules å’Œ package-lock.json
rm -rf node_modules package-lock.json

# é‡æ–°å®‰è£…
npm install
```

### é—®é¢˜ 2: Markdown ä¸æ¸²æŸ“

**æ£€æŸ¥**:
1. ç¡®è®¤ä¾èµ–å·²å®‰è£…ï¼š`npm list react-markdown`
2. ç¡®è®¤å¯¼å…¥æ­£ç¡®ï¼šæ£€æŸ¥ `import` è¯­å¥
3. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯

### é—®é¢˜ 3: ä»£ç é«˜äº®ä¸æ˜¾ç¤º

**è§£å†³**:
ç¡®è®¤ `highlight.js` CSS å·²å¯¼å…¥ï¼š
```tsx
import 'highlight.js/styles/github.css';
```

### é—®é¢˜ 4: é«˜äº®æ ‡è®°ä¸æ˜¾ç¤º

**æ£€æŸ¥**:
1. ç¡®è®¤ `rehype-raw` æ’ä»¶å·²æ·»åŠ 
2. ç¡®è®¤ CSS æ ·å¼å·²åŠ è½½
3. æŸ¥çœ‹æµè§ˆå™¨å¼€å‘è€…å·¥å…·ä¸­çš„å…ƒç´ 

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. æ€§èƒ½ä¼˜åŒ–

å¯¹äºè¶…é•¿å›ç­”ï¼Œè€ƒè™‘ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨ï¼š
```tsx
import { FixedSizeList } from 'react-window';
```

### 2. è‡ªå®šä¹‰æ ·å¼

ä¿®æ”¹ `HighlightedText.tsx` ä¸­çš„ `<style jsx global>` éƒ¨åˆ†ï¼š
```css
.markdown-body h1 {
  color: #your-color;
  font-size: 2.5em;
}
```

### 3. ä»£ç é«˜äº®ä¸»é¢˜

æ›´æ¢ highlight.js ä¸»é¢˜ï¼š
```tsx
// æ›¿æ¢ä¸ºå…¶ä»–ä¸»é¢˜
import 'highlight.js/styles/atom-one-dark.css';
import 'highlight.js/styles/monokai.css';
import 'highlight.js/styles/vs2015.css';
```

### 4. å®‰å…¨æ€§

`rehype-raw` å…è®¸ HTML æ ‡ç­¾ï¼Œæ³¨æ„ XSS é£é™©ã€‚å½“å‰å®ç°ä¸­ï¼š
- âœ… åªåœ¨é«˜äº®æ ‡è®°ä¸­ä½¿ç”¨ `<mark>` æ ‡ç­¾
- âœ… LLM è¿”å›çš„å†…å®¹ä¼šè¢« Markdown è½¬ä¹‰
- âœ… ç”¨æˆ·è¾“å…¥ä¸ç›´æ¥æ¸²æŸ“ä¸º HTML

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [react-markdown æ–‡æ¡£](https://github.com/remarkjs/react-markdown)
- [remark-gfm æ–‡æ¡£](https://github.com/remarkjs/remark-gfm)
- [highlight.js æ–‡æ¡£](https://highlightjs.org/)
- [RAGé«˜äº®åŠŸèƒ½æŠ€æœ¯æ–¹æ¡ˆæ–‡æ¡£.md](../RAGé«˜äº®åŠŸèƒ½æŠ€æœ¯æ–¹æ¡ˆæ–‡æ¡£.md)

## ğŸ‰ æ€»ç»“

### ä¼˜åŒ–æˆæœ

- âœ… å®Œæ•´çš„ Markdown æ¸²æŸ“æ”¯æŒ
- âœ… ä¿ç•™åŸæœ‰é«˜äº®åŠŸèƒ½
- âœ… GitHub é£æ ¼æ ·å¼
- âœ… ä»£ç è¯­æ³•é«˜äº®
- âœ… å“åº”å¼è¡¨æ ¼
- âœ… æµå¼æ˜¾ç¤ºä¼˜åŒ–

### æŠ€æœ¯äº®ç‚¹

1. **åŒæ¨¡å¼æ¸²æŸ“**: æµå¼é˜¶æ®µç”¨ MarkdownRendererï¼Œå®Œæˆåç”¨ HighlightedText
2. **æ— ç¼é›†æˆ**: é«˜äº®æ ‡è®°ä¸ Markdown å®Œç¾èåˆ
3. **æ ·å¼ç»Ÿä¸€**: é‡‡ç”¨ GitHub é£æ ¼ï¼Œä¸“ä¸šç¾è§‚
4. **æ€§èƒ½ä¼˜åŒ–**: ä½¿ç”¨ React ç»„ä»¶åŒ–ï¼Œé¿å…é‡å¤æ¸²æŸ“

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025-11-05  
**ä½œè€…**: ElastiQuest Team

